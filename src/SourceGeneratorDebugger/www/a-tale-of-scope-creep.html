
// <generated-html filename="a-tale-of-scope-creep.html">
/*
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>A Tale of Scope Creep</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
    <article>
        <header>
            <h1>A Tale of Scope Creep</h1>
            <time datetime="2013-11-05">November 05, 2013</time>
            
        </header>
        <h2 id="title-a-tale-of-scope-creep-published-november-05-2013-tags">title: A Tale of Scope Creep
published: November 05, 2013
tags:</h2>
<p><a href="https://www.throw-up.com/building-openresty">Zach Burke</a> mentioned to me that he wanted to add a 404 page to his new blog. Sounds like a good idea, lets do it.</p>
<p>I assumed I was going to <a href="https://stackoverflow.com/questions/3554844/asp-net-mvc-404-handling-and-iis7-httperrors">configure httpErrors</a>, but I figured I'd google a bit anyway. Turns out, there is quite a <a href="https://stackoverflow.com/a/9026907/214073">debate</a> about 404 pages with asp.net mvc. I decided I didn't really care about the nuances and I wanted to get the feature done. Good enough. <a href="https://github.com/kijanawoodard/Blog/commit/48ed632e7045522e1404f1739dcc2cd982a63697">Commit</a>.</p>
<p>Next I decided that the 404 page should display the post archive so that the user can choose a post that exists. Hmmm. Ok, a little <em>scope creep</em>: how about we have <a href="/archive">an independent archive page</a>. Fine. Using the <a href="/introducing-liaison">mediator</a>, it was straight forward to implement. <a href="https://github.com/kijanawoodard/Blog/commit/ce65020fdb81e06dab3a70365c7588407e695f1e">Commmit</a>.</p>
<p>So far so good. But the archive is rendered with the full layout on the 404 page. We don't want duplicate headers and sidebars. The easy answer is to write some code like this in the controller.</p>
<pre><code>if (ControllerContext.IsChildAction)
    return PartialView(model);
else
    return View(model);
</code></pre>
<p>Yuck. I don't like that. How can we remove this logic from our controller? I need something like <a href="https://lostechies.com/chadmyers/2011/06/23/cool-stuff-in-fubumvc-no-1-behaviors/">FubuMVC Behaviors</a>, but we don't have those in asp.net mvc.</p>
<p>After a quite a bit of <a href="https://github.com/kijanawoodard/Blog/blob/728c10ec6608cac03644454a7a38b7376bd10d71/src/Blog.Web/Infrastructure/PartialViewActionInvoker.cs#L8">stumbling around</a>, using an <code>IActionInvoker</code> derived from the built-in <code>ControllerActionInvoker</code> seemed to fit the bill pretty well. I'm not happy with the implementation of the class at all. It is a hack and it shows, but we're here to ship features, not build ivory towers. <a href="https://github.com/kijanawoodard/Blog/commit/728c10ec6608cac03644454a7a38b7376bd10d71">Commit</a>.</p>
<p>I used <a href="/introducing-vessel">Vessel</a> to <a href="https://github.com/kijanawoodard/Blog/commit/97dee8e93dd305436e7687892bebbcdfeba0b9de">wire</a> the <code>IActionInvoker</code> to the controller. In some sense, using Property Injection this way violates our sensibilities. My view is practical: I don't really want to do it this way, but this is what asp.net mvc gives me. I <em>don't</em> want the controller to have to muck about with setting their own ActionInvoker and I <em>really</em> don't want a controller base class. Yet, unless I'm ready to switch to <a href="https://fubumvc.github.io/">FubuMVC</a> or <a href="https://openrasta.org/">OpenRasta</a>, I'm not going to get a nice pipeline to work with. Using Property Injection seems like a reasonable compromise.</p>
<p>I've also decided to continue to leave the &quot;pain&quot; of manual controller setup in place. Connecting the action invoker was dead simple since there were no <a href="https://docs.structuremap.net/ConstructorAndSetterInjection.htm">container incantations</a> to consider. I also find that it makes me <em>think</em> about things like request pipelines, behavior chains, and the true responsibilities of a controller.</p>
<p><a href="/oops">404 page</a> done.</p>
<p>Side notes.</p>
<p>It turns out that setting the layout in the view overrides the partial view behavior, so I had to <a href="https://github.com/kijanawoodard/Blog/commit/728c10ec6608cac03644454a7a38b7376bd10d71#diff-8bc27b9c14ab2cf27debd6ecd280be8eL5">remove the layout declaration</a>. That led to adding a ViewStart page. <em>Scope creep</em>.</p>
<p>Conceptually, I like the views hierarchy to be composed by &quot;something outside of themselves&quot;. If the layout is hard coded in the view, it's hard to reuse in another layout. I <em>think</em> I would like that to be more specific than a ViewStart file, but I don't have bearings on an alternate solution.</p>
<p>It also turns out that the <code>Application_EndRequest</code> wasn't getting called when running on Azure Websites, aka <em>production</em>. Found an <a href="https://stackoverflow.com/a/18938991/214073">SO post</a> that solved the problem. <a href="https://github.com/kijanawoodard/Blog/commit/c5bcffeef6bc3e10c8fcf635ca5a8bff26d69357">Commit</a>. This scenario highlights the value of pushing to production often. The bug simply doesn't happen in dev/test. It <em>only</em> happens in production. Because the prod deploy was so small, it was easy to grok the issue and fix it.</p>
<p>The more I use <a href="https://git-scm.com/">git</a>, the more I like tiny commits that address a single issue. I don't bother to create tickets for personal projects, but in my head, I try and reason about the simplest way to solve a problem and then only commit code for that problem. Other issues I see along the way, I will either code them, but <a href="https://github.com/kijanawoodard/Blog/commit/8f3ae65d841bab2bc6287f41923a269a458adf94">commit</a> them individually, or make a note and come back to them later. Getting to <em>done</em> is vital.</p>
<hr />
<h1 id="comments-begin-here">comments begin here</h1>

    </article>
</body>
</html>
*/
// </generated-html>